name: Run Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ['3.11', '3.12', '3.13']
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest==8.4.2
    
    - name: Run tests for all modules
      run: |
        # Find all directories containing tests and run pytest
        # Clean cache before each module to avoid import conflicts
        for dir in hash_map_set graphs sorting linked_lists intervals tree two_pointers; do
          if [ -d "$dir" ]; then
            echo "Testing $dir..."
            find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
            find . -type f -name "*.pyc" -delete 2>/dev/null || true
            pytest -v --log-cli-level=INFO "$dir" || exit 1
          fi
        done
        
        echo "All module tests passed successfully!"
